package team.tygy.SG.interaction;

import static team.tygy.SG.util.ConstantUtil.DOWN;
import static team.tygy.SG.util.ConstantUtil.LEFT;
import static team.tygy.SG.util.ConstantUtil.RIGHT;
import static team.tygy.SG.util.ConstantUtil.UP;

import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;

import team.tygy.SG.blockade.Food;
import team.tygy.SG.snake.Snake;

/**
 * @ClassName: SnakeChange
 * @Description: TODO 处理蛇在移动过程中发生的事
 * @author 陈思祥
 * @date 2020年3月20日-下午4:48:54
 * @version 1.0
 * 
 */
public class SnakeChange implements KeyListener{

	private Snake snake;
	private Food food;
	
	
	public SnakeChange(Snake snake,Food food) {
		this.snake = snake;
		this.food = food;
	}
	
	
	/**
	 * 
	 * @ClassName: SnakeDriver
	 * @Description: TODO 控制蛇移动的线程内部类
	 * @author 陈思祥
	 * @date 2020年3月20日-上午12:04:15
	 * @version 1.0
	 *
	 */
	private class SnakeDriver implements Runnable {
		public void run() {
			while(snake.isLife()) {
				if(snake.isPause() == false) {
					if(food.isFoodEated(snake)) {
						snake.eatFood();
						food.newFood(food);
					}
					if(snake.isEatBody()) {
						snake.die();
					}
					snake.move();
				}
				try {	
					Thread.sleep(snake.getSleepTime());
				} catch (InterruptedException e) {
					e.printStackTrace();
					Thread.currentThread().interrupt();
				}
			}
		}
	}
	
	
	/**
	 * 
	 * @Title: begin 
	 * @Description: TODO 启动线程的方法
	 * @param  
	 * @return void
	 * @throws
	 */
	public void begin() {
		new Thread(new SnakeDriver()).start();
	}
	
	
	/**
	 * 键盘监听
	 */
	@Override
	public void keyPressed(KeyEvent e) {
		int key = e.getKeyCode();
		switch(key){
		case KeyEvent.VK_A :
			/**
			 * 方向变化时蛇不能回头，以下类同
			 */
			if(snake.getHead().getDir() != RIGHT){
				snake.getHead().setDir(LEFT);
			}
			break;
		case KeyEvent.VK_W :
			if(snake.getHead().getDir() != DOWN){
				snake.getHead().setDir(UP);
			}
			break;
		case KeyEvent.VK_D :
			if(snake.getHead().getDir() != LEFT){
				snake.getHead().setDir(RIGHT);
			}
			break;
		case KeyEvent.VK_S :
			if(snake.getHead().getDir() != UP){
				snake.getHead().setDir(DOWN);
			}
			break;
		case KeyEvent.VK_SPACE :
				/**
				 * 通过取原来状态的相反的状态，控制游戏的暂停和开始
				 * 注意：直接赋值只能产生一种状态：游戏暂停或开始
				 */
				snake.setPause(!snake.isPause());
			break;
		}
	}
	@Override
	public void keyReleased(KeyEvent e) {
		//TODO
	}
	@Override
	public void keyTyped(KeyEvent e) {
	}
}
